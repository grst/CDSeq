pseudo_cell_count = 100,
seurat_find_marker = FALSE,
seurat_nfeatures = 1000,
batch_correction = 1,
seurat_npcs = 30,
seurat_dims=1:20,
#nb_size = 50000,
#nb_mu = 50000,
plot_umap = 1,
fig_save = 0,
fig_path = "~/Downloads/",
plot_tsne = 0,
verbose = 1)
gtex_anno$cdseq_scRNA_umap
View(major_markers_df)
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "SLC1A2")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "FAM189A2")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "SLC14A1")
dim(cdseq_estGEP)
length(CDSeq_result$est_all)
cdseq_estGEP = CDSeq_result$est_all[[16]]$estGEP[comm_gene$index[[2]],]
cdseq_estGEP = CDSeq_result$est_all[[16]]$estGEP#[comm_gene$index[[2]],]
cdseq_estGEP = t(t(cdseq_estGEP)/colSums(cdseq_estGEP))
gtex_anno = CDSeq::cellTypeAssignSCRNA(cdseq_gep = cdseq_estGEP,
cdseq_prop = CDSeq_result$estProp,
#sc_gep = sc_gep_ad,
#sc_annotation = sc_annotation_ad,
#sc_batch = sc_batch_ad,
pseudo_cell_count = 100,
seurat_find_marker = FALSE,
seurat_nfeatures = 1000,
batch_correction = 1,
seurat_npcs = 30,
seurat_dims=1:20,
#nb_size = 50000,
#nb_mu = 50000,
plot_umap = 1,
fig_save = 0,
fig_path = "~/Downloads/",
plot_tsne = 0,
verbose = 1)
cdseq_estprop = CDSeq_result$est_all[[16]]$estProp
gtex_anno = CDSeq::cellTypeAssignSCRNA(cdseq_gep = cdseq_estGEP,
cdseq_prop = cdseq_estprop,
#sc_gep = sc_gep_ad,
#sc_annotation = sc_annotation_ad,
#sc_batch = sc_batch_ad,
pseudo_cell_count = 100,
seurat_find_marker = FALSE,
seurat_nfeatures = 1000,
batch_correction = 1,
seurat_npcs = 30,
seurat_dims=1:20,
#nb_size = 50000,
#nb_mu = 50000,
plot_umap = 1,
fig_save = 0,
fig_path = "~/Downloads/",
plot_tsne = 0,
verbose = 1)
gtex_anno$cdseq_scRNA_umap
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "SLC14A1")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "SLC1A2")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "FAM189A2")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "SLC1A3")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "ANGPTL4")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "F13A1")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "TGFBI")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "HTR2C")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "FLT1")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "VWF")
FeaturePlot(gtex_anno$cdseq_synth_scRNA_seurat,features = "DAB1")
length(major_markers)
# multi-region test
load("~/Downloads/50410319.RData")
rownames(bulk_data)[1]
class(bulk_data)
bulk_data_filter = bulk_data[major_markers, ]
dim(bulk_data_filter)
View(bulk_data_filter)
major_markers
bulk_data_filter = bulk_data[ rownames(bulk_data) %in% major_markers, ]
dim(bulk_data_filter)
View(bulk_data_filter)
cell_type_number = 5:10
gtex_test  = CDSeq::CDSeq(bulk_data = bulk_data_filter,
dilution_factor = 100,
cell_type_number = cell_type_number,
mcmc_iterations = 1000,
cpu_number = length(cell_type_number))
gtex_test  = CDSeq::CDSeq(bulk_data = bulk_data_filter,
dilution_factor = 10,
cell_type_number = cell_type_number,
mcmc_iterations = 1000,
cpu_number = length(cell_type_number))
dim(gtex_test$estGEP)
cell_type_number = 20#5:10
gtex_test  = CDSeq::CDSeq(bulk_data = bulk_data_filter,
dilution_factor = 1,
cell_type_number = cell_type_number,
mcmc_iterations = 1000,
cpu_number = length(cell_type_number))
MR_anno = CDSeq::cellTypeAssignSCRNA(cdseq_gep = gtex_test$estGEP,
cdseq_prop = gtex_test$estProp,
#sc_gep = sc_gep_ad,
#sc_annotation = sc_annotation_ad,
#sc_batch = sc_batch_ad,
pseudo_cell_count = 100,
seurat_find_marker = FALSE,
seurat_nfeatures = 1000,
batch_correction = 1,
seurat_npcs = 30,
seurat_dims=1:20,
#nb_size = 50000,
#nb_mu = 50000,
plot_umap = 1,
fig_save = 0,
fig_path = "~/Downloads/",
plot_tsne = 0,
verbose = 1)
MR_anno = CDSeq::cellTypeAssignSCRNA(cdseq_gep = gtex_test$estGEP,
cdseq_prop = gtex_test$estProp,
#sc_gep = sc_gep_ad,
#sc_annotation = sc_annotation_ad,
#sc_batch = sc_batch_ad,
pseudo_cell_count = 100,
seurat_find_marker = FALSE,
seurat_nfeatures = 1000,
batch_correction = 1,
seurat_npcs = 30,
seurat_dims=1:20,
nb_size = 50000,
nb_mu = 50000,
plot_umap = 1,
fig_save = 0,
fig_path = "~/Downloads/",
plot_tsne = 0,
verbose = 1)
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "SLC1A2")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "FAM189A2")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "SLC14A1")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "ANGPTL4")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "F13A1")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "TGFBI")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "CD163")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "FCGR2A")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "HTR2C")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "VWF")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "DAB1")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "APBB1IP")
FeaturePlot(MR_anno$cdseq_synth_scRNA_seurat,features = "PLP1")
View(teddy_annotation$cdseq_synth_scRNA_seurat_markers)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("IL7R"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("CCR7"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("ADAM8"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("ABLIM1"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("ZNF683"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("CD8B"), pt.size=3)
FeaturePlot(teddy_annotation$cdseq_synth_scRNA_seurat,#grep("CDSeq",names(teddy_annotation$cdseq_synth_scRNA_seurat@active.ident))
features = c("CD8A"), pt.size=3)
names(teddy_annotation$cdseq_synth_scRNA_seurat_markers)
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene=="CD8A")
teddy_deconv_marker
View(teddy_deconv_marker)
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene=="CD8A" && avg_log2FC>0)
View(teddy_deconv_marker)
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene=="CD8A")
View(teddy_deconv_marker)
names(teddy_deconv_marker)
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene=="CD8A" & avg_log2FC>0)
teddy_deconv_marker
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% c("CCR7", "CD27", "IL7R") & avg_log2FC>0)
View(teddy_deconv_marker)
unique(teddy_deconv_marker$cluster)
table(teddy_deconv_marker$cluster)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
teddy_deconv_marker_df
which(teddy_deconv_marker_df$Freq=3)
which(teddy_deconv_marker_df$Freq==3)
names(teddy_deconv_marker_df) = c("cluster","freq")
teddy_deconv_marker_df
jpeg(filename = "~/Dropbox/Public/MIT/Project_7_TEDDY/CDSeq_TEDDY_chunks/heatmap_marker.jpeg",width = 7,height = 6,units = "in",res = 300)
dev.off()
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$Freq==total_markers)]
marker_llist = c("CCR7", "CD27", "IL7R") # T memory
total_markers = length(marker_list)
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
marker_list = c("CCR7", "CD27", "IL7R") # T memory
total_markers = length(marker_list)
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$Freq==total_markers)]
T_memory_cell
teddy_deconv_marker_df = as.data.frame(table(as.character(teddy_deconv_marker$cluster)))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$Freq==total_markers)]
T_memory_cell
total_markers
which(teddy_deconv_marker_df$Freq==total_markers)
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$freq==total_markers)]
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$freq==total_markers)]
T_memory_cell
teddy_deconv_marker_df = as.data.frame(table(as.character(teddy_deconv_marker$cluster)))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df$freq==total_markers)]
T_memory_cell
class(teddy_deconv_marker$cluster)
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
as.character(T_memory_cell)
as.numeric(T_memory_cell)
T_memory_cell
teddy_deconv_marker_df = as.data.frame(table(as.numeric(teddy_deconv_marker$cluster)))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
marker_list = c("CD4","CTLA4", "FOXP3","IL2RA")#c("CCR7", "CD27", "IL7R") # T memory
total_markers = length(marker_list)
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
teddy_deconv_marker_df
View(teddy_deconv_marker)
offset = 2
total_markers = length(marker_list) - offset
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
marker_list = c("CCR7", "CD27", "CD8A", "CD8B")#c("CCR7", "CD27", "IL7R") # T memory
offset = 0
total_markers = length(marker_list) - offset
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
offset = 1
total_markers = length(marker_list) - offset
log2FC_threshold = 0
teddy_deconv_marker = teddy_annotation$cdseq_synth_scRNA_seurat_markers %>% filter(gene %in% marker_list & avg_log2FC>log2FC_threshold)
teddy_deconv_marker_df = as.data.frame(table(teddy_deconv_marker$cluster))
names(teddy_deconv_marker_df) = c("cluster","freq")
T_memory_cell = teddy_deconv_marker_df$cluster[ which(teddy_deconv_marker_df[["freq"]]==total_markers)]
T_memory_cell
?cellTypeAssignSCRNA
dim(gtex_test$estGEP)
load("~/Downloads/By_cell_type/Opc.RData")
opc = bulk_data
load("~/Downloads/By_cell_type/Ast.RData")
ast = bulk_data
load("~/Downloads/By_cell_type/Mic_Immune.RData")
mic = bulk_data
load("~/Downloads/By_cell_type/Oli.RData")
oli = bulk_data
load("~/Downloads/By_cell_type/Exc.RData")
exc = bulk_data
load("~/Downloads/By_cell_type/Inh.RData")
inh = bulk_data
load("~/Downloads/By_cell_type/Vasc_Epithelia.RData")
vas = bulk_data
MR_cell = c(opc = opc, ast = ast, mic = mic, oli = oli, exc = exc, inh = inh, vas = vas)
rownames(MR_cell)[1]
View(opc)
bulk_data
bulk_data[1,1]
View(bulk_data)
bulk_data
c(0.02,0.1,0.5)/sum(0.02+0.1+0.5)
b=c(0.08,0.1,0.2)/sum(0.08+0.1+0.2)
a=c(0.02,0.1,0.5)/sum(0.02+0.1+0.5)
a
b
(a+b)/2
load("~/Downloads/By_cell_type/Opc.RData")
opc = bulk_cell_type
load("~/Downloads/By_cell_type/Ast.RData")
ast = bulk_cell_type
load("~/Downloads/By_cell_type/Mic_Immune.RData")
mic = bulk_cell_type
load("~/Downloads/By_cell_type/Oli.RData")
oli = bulk_cell_type
load("~/Downloads/By_cell_type/Exc.RData")
exc = bulk_cell_type
load("~/Downloads/By_cell_type/Inh.RData")
inh = bulk_cell_type
load("~/Downloads/By_cell_type/Vasc_Epithelia.RData")
vas = bulk_cell_type
MR_cell = c(opc = opc, ast = ast, mic = mic, oli = oli, exc = exc, inh = inh, vas = vas)
dim(MR_cell)
dim(vas)
MR_cell = cbind(opc = opc, ast = ast, mic = mic, oli = oli, exc = exc, inh = inh, vas = vas)
dim(MR_cell)
rownames(MR_cell)[1]
dim(gtex_test$estGEP)
class(MR_cell)
MR_comm = CDSeq:::intersection(list.vector = list(rownames(gtex_test$estGEP), rownames(MR_cell)),order = 'stable')
length(MR_comm$comm.value)
MR_cell_filter = MR_cell[MR_comm$index[[2]],]
pheatmap::pheatmap(cor(gtex_test$estGEP,MR_cell_filter))
class(oli)
names(MR_cell)
MR_cell = data.frame(opc = opc, ast = ast, mic = mic, oli = oli, exc = exc, inh = inh, vas = vas)
names(MR_cell)
names(opc)
names(opc) = "Opc"
names(ast) = "Ast"
names(mic) = "Mic"
names(oli) = "Oli"
names(exc) = "Exc"
names(inh) = "Inh"
names(vas) = "Vas"
MR_cell = cbind(opc = opc, ast = ast, mic = mic, oli = oli, exc = exc, inh = inh, vas = vas)
MR_comm = CDSeq:::intersection(list.vector = list(rownames(gtex_test$estGEP), rownames(MR_cell)),order = 'stable')
MR_cell_filter = MR_cell[MR_comm$index[[2]],]
pheatmap::pheatmap(cor(gtex_test$estGEP,MR_cell_filter))
colSums(MR_cell)
a = gtools::rdirichlet(n=1,alpha = c(0.1,0.2,0.7))
a
load("/Users/kaikang/Dropbox/Public/MIT/Project_3_GTEx_data_analysis/Data/GTEx_V8_DerivedData/R/GTEx_V8_RNASeq_subTissueTypes_protein_coding_gene/GTEx_Artery_Aorta.RData")
gtex_rowsum = rowSums(GTEx_RNAseq)
gtex_rowsum_sort = sort(gtex_rowsum, decreasing = TRUE, index.return=TRUE)
gtex_gene_idx = gtex_rowsum_sort$ix[50:550]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
cell_type_number = seq(5,20,2)
cell_type_number
scRNAseq_cts = data.table::fread("~/Downloads/coronary_data/coronary_raw_counts_tsv.txt")
dim(scRNAseq_cts)
View(scRNAseq_cts)
scRNAseq_meta = data.table::fread("~/Downloads/coronary_data/coronary_metadata.txt")
View(scRNAseq_meta)
class(scRNAseq_cts)
rownames(scRNAseq_cts) = scRNAseq_cts$V1
scRNAseq_cts = scRNAseq_cts[,-1]
View(scRNAseq_cts)
##################################################################
##                          GTEx Aorta                          ##
##################################################################
library(dplyr)
library(plyr)
scRNAseq_cts = data.table::fread("~/Downloads/coronary_data/coronary_raw_counts_tsv.txt") %>% as.matrix()
dim(scRNAseq_cts)
View(scRNAseq_cts)
rownames(scRNAseq_cts) = scRNAseq_cts[,1]
rownames(scRNAseq_cts)[1]
View(scRNAseq_cts)
View(scRNAseq_cts[1:10,1:10])
scRNAseq_cts = scRNAseq_cts[,-1]
View(scRNAseq_cts[1:10,1:10])
cell_annotation = data.frame(cellid = scRNAseq_meta$V1, celltype = scRNAseq_meta$celltypeNames)
head(cell_annotation)
sub("\\*..","","sdfa.ser")
sub("\\..*","","sdfa.ser")
sub("\\. ()*","","sdfa (1)")
sub("\\.()*","","sdfa (1)")
sub("\\. *","","sdfa (1)")
sub(" .*","","sdfa (1)")
cell_annotation$celltype = sub(" .*","",cell_annotation$celltype)
head(cell_annotation)
?rowsum
dim(cell_annotation)
dim(scRNAseq_cts)
cell_annotation$cellid[1:4]
colnames(scRNAseq_cts)[1:4]
sc_cts =  t(rowsum(t(scRNAseq_cts), group = cell_annotation$celltype))
dim(scRNAseq_cts)
length(cell_annotation$celltype)
class(scRNAseq_cts)
scRNAseq_cts[1:4,1:4]
scRNAseq_cts = as.numeric(scRNAseq_cts)
scRNAseq_cts[1:4,1:4]
dim(scRNAseq_cts)
?fread
scRNAseq_cts = read.table("~/Downloads/coronary_data/coronary_raw_counts_tsv.txt",sep = "\t", header = TRUE) %>% as.matrix()
dim(scRNAseq_cts)
View(scRNAseq_cts)
class(scRNAseq_cts)
scRNAseq_cts[1:2,1:2]
sc_cts =  t(rowsum(t(scRNAseq_cts), group = cell_annotation$celltype))
View(sc_cts)
dim(sc_cts)
length(gtex_gene_idx)
rownames(sc_cts)[1]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
length(comm_gene$comm.value)
length(unique(rownames(bulk_data)))
length(unique(rownames(sc_cts)))
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
dim(bulk_input)
cell_type_number = seq(5,15,2)
cell_type_number
cell_type_number = seq(5,15,3)
cell_type_number
cell_type_number = seq(5,15,2)
aorta_result  = CDSeq::CDSeq(bulk_data = bulk_input,
dilution_factor = 100,
cell_type_number = cell_type_number,
mcmc_iterations = 700,
cpu_number = min(length(cell_type_number),10))
gtex_gene_idx = gtex_rowsum_sort$ix[50:150]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
dim(bulk_input)
dim(sc_ref)
identical(rownames(sc_ref),rownames(bulk_input))
cell_type_number = seq(5,15,2)
aorta_result  = CDSeq::CDSeq(bulk_data = bulk_input,
dilution_factor = 100,
cell_type_number = cell_type_number,
mcmc_iterations = 700,
cpu_number = min(length(cell_type_number),10))
aorta_result  = CDSeq::CDSeq(bulk_data = bulk_input,
dilution_factor = 10,
cell_type_number = cell_type_number,
mcmc_iterations = 700,
cpu_number = min(length(cell_type_number),10))
dim(aorta_result$estGEP)
pheatmap::pheatmap(cor(aorta_result$estGEP,sc_ref))
load("/Users/kaikang/Dropbox/Public/MIT/Project_3_GTEx_data_analysis/Data/GTEx_V8_DerivedData/R/GTEx_V8_RNASeq_subTissueTypes_protein_coding_gene/GTEx_Artery_Coronary.RData")
gtex_rowsum = rowSums(GTEx_RNAseq)
gtex_rowsum_sort = sort(gtex_rowsum, decreasing = TRUE, index.return=TRUE)
gtex_gene_idx = gtex_rowsum_sort$ix[50:150]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
dim(bulk_input)
sc_ref = sc_cts[comm_gene$index[[2]],]
cell_type_number = seq(5,15,2)
aorta_result  = CDSeq::CDSeq(bulk_data = bulk_input,
dilution_factor = 10,
cell_type_number = cell_type_number,
mcmc_iterations = 700,
cpu_number = min(length(cell_type_number),10))
pheatmap::pheatmap(cor(aorta_result$estGEP,sc_ref))
dim(aorta_result$estGEP)
pheatmap::pheatmap(cor(sc_ref))
gtex_gene_idx = gtex_rowsum_sort$ix[50:550]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
dim(sc_ref)
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
gtex_gene_idx = gtex_rowsum_sort$ix[10:550]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
gtex_gene_idx = gtex_rowsum_sort$ix[10:1050]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
gtex_gene_idx = gtex_rowsum_sort$ix[10:550]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
gtex_gene_idx = gtex_rowsum_sort$ix[10:150]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
gtex_gene_idx = gtex_rowsum_sort$ix[10:350]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
gtex_gene_idx = gtex_rowsum_sort$ix[10:350]
bulk_data = GTEx_RNAseq[gtex_gene_idx, 1:30]
comm_gene = CDSeq:::intersection(list.vector = list(rownames(bulk_data), rownames(sc_cts)), order = "stable")
bulk_input = bulk_data[comm_gene$index[[1]],]
sc_ref = sc_cts[comm_gene$index[[2]],]
pheatmap::pheatmap(cor(sc_ref))
dim(bulk_input)
cell_type_number = seq(5,35,5)
aorta_result  = CDSeq::CDSeq(bulk_data = bulk_input,
dilution_factor = 10,
cell_type_number = cell_type_number,
mcmc_iterations = 700,
cpu_number = min(length(cell_type_number),10))
dim(sc_cts)
dim(scRNAseq_cts)
class(scRNAseq_cts)
coronary_scRNAseq = list()
coronary_scRNAseq$scRNAseq_cts = scRNAseq_cts
coronary_scRNAseq$scRNAseq_meta = scRNAseq_meta
coronary_scRNAseq$cell_annotation = cell_annotation
coronary_scRNAseq$sc_cts = sc_cts
saveRDS(coronary_scRNAseq, file = "~/Dropbox/Public/MIT/Project_3_GTEx_data_analysis/Data/coronary_scRANseq/coronary_scRNAseq.rds")
